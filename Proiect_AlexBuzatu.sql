SELECT * FROM UTILIZATORI;
SELECT id_utilizator, count(*) FROM CONTURI group by id_utilizator;
SELECT * FROM CATEGORII;
SELECT id_categorie ,count(*) FROM TRANZACTII group by id_categorie;
SELECT * FROM TRANZACTII;
select * from datorii;
select * from bugete;

CREATE TABLE UTILIZATORI(
ID_UTILIZATOR NUMBER(5) PRIMARY KEY,
NUME VARCHAR2(50) NOT NULL,
PRENUME VARCHAR2(50),
DATA_NASTERII DATE,
EMAIL VARCHAR2(30)
);

INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES(1,'BUZATU','ALEXANDRU',TO_DATE('2003-03-11','YYYY-MM-DD'),'ALEXB@YAHOO.COM');
UPDATE UTILIZATORI SET NUME='Buzatu' where id_utilizator=1;
UPDATE UTILIZATORI SET PRENUME='Alexandru' where id_utilizator=1;
UPDATE UTILIZATORI SET EMAIL='alexb@yahoo.com' where id_utilizator=1;
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (2, 'Ionescu', 'Andrei', TO_DATE('1990-05-15', 'YYYY-MM-DD'), 'andrei.ionescu@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (3, 'Popescu', 'Maria', TO_DATE('1985-10-23', 'YYYY-MM-DD'), 'maria.popescu@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (4, 'Dumitrescu', 'Elena', TO_DATE('1992-07-30', 'YYYY-MM-DD'), 'elena.dumitrescu@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (5, 'Vasilescu', 'Bogdan', TO_DATE('1988-03-14', 'YYYY-MM-DD'), 'bogdan.vasilescu@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (6, 'Mihai', 'Ioana', TO_DATE('1995-12-05', 'YYYY-MM-DD'), 'ioana.mihai@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (7, 'Georgescu', 'Cristian', TO_DATE('1982-11-21', 'YYYY-MM-DD'), 'cristian.georgescu@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (8, 'Stanescu', 'Alina', TO_DATE('1993-04-16', 'YYYY-MM-DD'), 'alina.stanescu@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (9, 'Petrescu', 'Dan', TO_DATE('1990-09-09', 'YYYY-MM-DD'), 'dan.petrescu@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (10, 'Manole', 'Andreea', TO_DATE('1991-01-22', 'YYYY-MM-DD'), 'andreea.manole@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (11, 'Constantinescu', 'Victor', TO_DATE('1986-05-30', 'YYYY-MM-DD'), 'victor.c@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (12, 'Ionescu-Mihai', 'Andrei', TO_DATE('2000-05-03', 'YYYY-MM-DD'), 'andreiim@email.com');
INSERT INTO UTILIZATORI (ID_UTILIZATOR, NUME, PRENUME, DATA_NASTERII, EMAIL) VALUES (13, 'Barbu', 'Alexandru', TO_DATE('2003-09-26', 'YYYY-MM-DD'), 'alexbarbu@email.com');

CREATE TABLE CONTURI(
ID_CONT NUMBER(5) PRIMARY KEY,
ID_UTILIZATOR NUMBER(5),
TIP_CONT VARCHAR2(30) NOT NULL,
SOLD NUMBER(5) NOT NULL,
CONSTRAINT CTI_FK_UTIL FOREIGN KEY(ID_UTILIZATOR) REFERENCES UTILIZATORI
);
ALTER TABLE CONTURI ADD CONSTRAINT CH_ID_UTIL CHECK(ID_UTILIZATOR IS NOT NULL);
ALTER TABLE CONTURI ADD CONSTRAINT CH_TIP_CONT CHECK(TIP_CONT IN ('Curent','Economii'));

INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (100, 1, 'Curent', 3000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (101, 1, 'Economii', 10000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (102, 2, 'Curent', 5000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (103, 2, 'Economii', 12000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (104, 3, 'Economii', 12000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (105, 4, 'Economii', 15000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (106, 5, 'Curent', 4300);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (107, 5, 'Economii', 4000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (108, 6, 'Economii', 11000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (109, 7, 'Curent', 7600);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (110, 7, 'Economii', 5000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (111, 8, 'Curent', 6400);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (112, 9, 'Economii', 9800);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (113, 10, 'Curent', 7200);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (114, 11, 'Curent', 9000);--
INSERT INTO CONTURI (ID_CONT, ID_UTILIZATOR, TIP_CONT, SOLD) VALUES (115, 13, 'Economii', 10000);--

CREATE TABLE CATEGORII(
ID_CATEGORIE NUMBER(5),
ID_CATEG_PARINTE NUMBER(5),
DENUMIRE_CATEG VARCHAR2(50),
CONSTRAINT PK_CATEG PRIMARY KEY(ID_CATEGORIE)
);
ALTER TABLE CATEGORII ADD CONSTRAINT FK_ID_CTG_PRE FOREIGN KEY(ID_CATEG_PARINTE) 
REFERENCES CATEGORII;
ALTER TABLE CATEGORII ADD CONSTRAINT CH_DENUM CHECK(DENUMIRE_CATEG IS NOT NULL);

INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (1,'Transport');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (2,'Facturi');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (3,'Imbracaminte');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (4,'Educatie');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (5,'Sanatate');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (6,'Divertisment');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (7,'Cumparaturi');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (8,'Vacante');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (9,'Salariu');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (10, 'Masina');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (101, 1, 'Abonament transport in comun');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (102, 1, 'Combustibil');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (201, 2, 'Electricitate');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (202, 2, 'Gaz');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (203, 2, 'Apa');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (204, 2, 'Internet si Telefonie');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (401, 4, 'Taxe scolare');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (402, 4, 'Culegeri');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (501, 5, 'Dentist');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (502, 5, 'Analize');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (503, 5, 'Retete medicale');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (504, 5, 'Control medical');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (601, 6, 'Iesiri in oras');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (602, 6, 'Carti');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (603, 6, 'Filme si seriale');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (604, 6, 'Evenimente');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (701, 7, 'Produse alimentare');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (702, 7, 'Jucarii');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (703, 7, 'Electronice');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (205, 2, 'Facturi abonamente');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (1001, 10, 'Spalat masina');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (1002, 10, 'Asigurare masina');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (1003, 10, 'Parcare');
INSERT INTO Categorii (ID_CATEGORIE, ID_CATEG_PARINTE, DENUMIRE_CATEG) VALUES (1004, 10, 'Service');
INSERT INTO CATEGORII (ID_CATEGORIE, DENUMIRE_CATEG) VALUES (11, 'Cadouri');

CREATE TABLE TRANZACTII(
ID_TRANZACTIE NUMBER(5) PRIMARY KEY,
ID_CONT NUMBER(5) NOT NULL,
ID_CATEGORIE NUMBER(5) NOT NULL,
SUMA NUMBER(10,2) NOT NULL,
DATA_TRANZACTIE DATE NOT NULL,
TIP_TRANZACTIE VARCHAR2(10) CHECK (TIP_TRANZACTIE IN ('Venit','Cheltuiala'))
);

ALTER TABLE TRANZACTII ADD CONSTRAINT FK_TranzCont FOREIGN KEY (ID_CONT)
REFERENCES CONTURI;
ALTER TABLE TRANZACTII ADD CONSTRAINT FK_TranzCateg FOREIGN KEY (ID_CATEGORIE)
REFERENCES CATEGORII;
ALTER TABLE TRANZACTII ADD CONSTRAINT CH_SUMA CHECK(SUMA>=0);

--UTILIZATOR 1
INSERT INTO TRANZACTII VALUES (1,100,101,150.00, TO_DATE('2023-01-15','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES (2,100,204, 60.00, TO_DATE('2022-01-01','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES (3,100, 9, 4500.00, TO_DATE('2023-07-10','YYYY-MM-DD'), 'Venit');
INSERT INTO TRANZACTII VALUES (4,101,8,2500.00, TO_DATE('2022-10-10','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES (5,101,703,200.00, TO_DATE('2023-9-26','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES (6,100,1001,50.00, TO_DATE('2023-7-9','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES (7,101,504,230.00, TO_DATE('2023-7-10','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 2(102 CURENT SI 103 ECONOMII)
INSERT INTO TRANZACTII VALUES(8,102,501, 500.00, TO_DATE('2023-8-8','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(9,103, 8, 4500.00,TO_DATE('2023-6-20','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(10,102, 102, 300.00, TO_DATE('2023-9-21','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(11,102, 9, 4000.00, TO_DATE('2022-11-9','YYYY-MM-DD'), 'Venit');
INSERT INTO TRANZACTII VALUES(12,102, 1004, 1350.00, TO_DATE('2023-9-12','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(13,103, 601, 450.00, TO_DATE('2023-8-3','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 3(104 EC)
INSERT INTO TRANZACTII VALUES(14,104, 703, 6000.00, TO_DATE('2023-10-15','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(15,104, 1003, 20.00, TO_DATE('2023-11-7','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(16,104, 9, 1000.00, TO_DATE('2023-12-1','YYYY-MM-DD'), 'Venit');
INSERT INTO TRANZACTII VALUES(17,104, 8, 5000.00, TO_DATE('2023-10-10','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 4(105 EC)
INSERT INTO TRANZACTII VALUES(18,105, 601, 120.00, TO_DATE('2023-12-20','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(19,105, 702, 500.00, TO_DATE('2023-12-6','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(20,105, 202, 200.00, TO_DATE('2023-11-30','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(21,105, 203, 150.00, TO_DATE('2023-11-30','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(22,105, 501, 275.00, TO_DATE('2023-11-30','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 5(106 crt si 107 ec)
INSERT INTO TRANZACTII VALUES(23,106, 502, 1000.00, TO_DATE('2023-12-1','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(24,106, 9, 5000.00, TO_DATE('2023-3-11','YYYY-MM-DD'), 'Venit');
INSERT INTO TRANZACTII VALUES(25,107, 8, 2500.00, TO_DATE('2023-5-10','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(26,106, 503, 280.00, TO_DATE('2023-12-1','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(27,107, 9, 1000.00, TO_DATE('2023-6-10','YYYY-MM-DD'), 'Venit');
INSERT INTO TRANZACTII VALUES(28,107, 3, 650.00, TO_DATE('2023-5-20','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(29,106, 9, 1200.00, TO_DATE('2023-7-10','YYYY-MM-DD'), 'Venit');
INSERT INTO TRANZACTII VALUES(30,106, 502, 480.00, TO_DATE('2023-12-1','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 6(108 ec)
INSERT INTO TRANZACTII VALUES(31,108, 604, 750.00, TO_DATE('2023-9-28','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(32,108, 602, 250.00, TO_DATE('2023-10-1','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(33,108, 703, 2750.00, TO_DATE('2023-9-9','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 7(109 crt 110 ec)
INSERT INTO TRANZACTII VALUES(34,109, 201, 340.00, TO_DATE('2023-3-1','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(35,109, 202, 250.00, TO_DATE('2023-3-1','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(36,109, 9, 2500.00, TO_DATE('2023-12-1','YYYY-MM-DD'), 'Venit');
INSERT INTO TRANZACTII VALUES(37,110, 8, 3000.00, TO_DATE('2023-12-15','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(38,110, 9, 500.00, TO_DATE('2023-12-29','YYYY-MM-DD'), 'Venit');
--UTILIZATOR 8(111 crt)
INSERT INTO TRANZACTII VALUES(39,111, 1002, 520.00, TO_DATE('2023-4-1','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(40,111, 503, 120.00, TO_DATE('2023-8-15','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(41,111, 602, 250.00, TO_DATE('2023-6-15','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(42,111, 1004, 550.00, TO_DATE('2023-6-15','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(43,111, 702, 450.00, TO_DATE('2023-12-22','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 9(112 ec)
INSERT INTO TRANZACTII VALUES(44,112, 703, 1700.00, TO_DATE('2023-8-27','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(45,112, 8, 2200.00, TO_DATE('2023-2-11','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(46,112, 604, 300.00, TO_DATE('2023-8-1','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(47,114, 3, 800.00, TO_DATE('2023-9-7','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 10(113 crt)
INSERT INTO TRANZACTII VALUES(48,113, 601, 180.00, TO_DATE('2023-11-3','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(49,113, 102, 400.00, TO_DATE('2023-11-20','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(50,113, 504, 400.00, TO_DATE('2023-2-1','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(51,113, 503, 400.00, TO_DATE('2023-2-1','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 11(114 crt)
INSERT INTO TRANZACTII VALUES(52,114, 3, 1000.00, TO_DATE('2023-12-27','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(53,114, 604, 600.00, TO_DATE('2023-11-20','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(54,114, 603, 150.00, TO_DATE('2023-11-3','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(55,114, 701, 500.00, TO_DATE('2023-4-2','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(56,114, 702, 300.00, TO_DATE('2023-4-1','YYYY-MM-DD'), 'Cheltuiala');
--UTILIZATOR 12 NU ARE CONT
--utilizator 13(115 economii)
INSERT INTO TRANZACTII VALUES(57,115, 3, 600.00, TO_DATE('2023-11-20','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(58,115, 3, 750.00, TO_DATE('2023-11-22','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(59,115, 401, 2500.00, TO_DATE('2023-8-8','YYYY-MM-DD'), 'Cheltuiala');
INSERT INTO TRANZACTII VALUES(60,115, 9, 1600.00, TO_DATE('2023-11-20','YYYY-MM-DD'), 'Venit');

CREATE TABLE DATORII(
ID_DATORIE NUMBER(5) PRIMARY KEY,
ID_UTILIZATOR NUMBER(5) NOT NULL,
CREDITOR VARCHAR2(50) NOT NULL,
SUMA_DATORATA DECIMAL(8,2) NOT NULL,
DOBANDA DECIMAL(5,2),
DATA_INCEPERE DATE,
STATUS VARCHAR2(30),
CONSTRAINT Ch_Status CHECK (STATUS IN ('Activa', 'Inchisa'))
);
ALTER TABLE DATORII ADD CONSTRAINT FK_DatorieUtilizator FOREIGN KEY (ID_UTILIZATOR) 
REFERENCES UTILIZATORI;
ALTER TABLE DATORII ADD CONSTRAINT CH_SUMA_DAT CHECK(SUMA_DATORATA>=0);
ALTER TABLE DATORII MODIFY SUMA_DATORATA NUMBER(8,2); 
ALTER TABLE DATORII MODIFY DOBANDA NUMBER(8,2); 
DESC DATORII;

INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DOBANDA, DATA_INCEPERE, STATUS)
VALUES (1, 13, 'Banca Transilvania', 5000.00, 5.5, TO_DATE('2023-01-01','YYYY-MM-DD'), 'Activa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (2, 13, 'Retailer Online', 1500.00, TO_DATE('2023-11-11','YYYY-MM-DD'), 'Inchisa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (3, 12, 'Politie', 1200.00, TO_DATE('2023-7-9','YYYY-MM-DD'), 'Inchisa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (4, 4, 'ANAF', 3000.00, TO_DATE('2023-3-30','YYYY-MM-DD'), 'Activa');
UPDATE DATORII SET CREDITOR='FISC' WHERE ID_DATORIE=4;
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (5, 4, 'BCR', 10000.00, TO_DATE('2023-3-11','YYYY-MM-DD'), 'Inchisa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (6, 3, 'CASS', 1000.00, TO_DATE('2023-2-4','YYYY-MM-DD'), 'Activa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (7, 6, 'ANAF', 7000.00, TO_DATE('2023-2-3','YYYY-MM-DD'), 'Activa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (8, 5, 'CASS', 1000.00, TO_DATE('2023-11-17','YYYY-MM-DD'), 'Activa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (9, 10, 'ING', 1340.00, TO_DATE('2023-11-9','YYYY-MM-DD'), 'Inchisa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (10, 2, 'ENGIE', 450.00, TO_DATE('2023-9-11','YYYY-MM-DD'), 'Activa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (11, 9, 'HIDROELECTRICA', 850.00, TO_DATE('2023-3-10','YYYY-MM-DD'), 'Activa');
INSERT INTO DATORII (ID_DATORIE, ID_UTILIZATOR, CREDITOR, SUMA_DATORATA, DATA_INCEPERE, STATUS)
VALUES (12, 1, 'BUGET DE STAT', 500.00, TO_DATE('2023-7-8','YYYY-MM-DD'), 'Activa');
UPDATE DATORII SET STATUS=NULL WHERE ID_DATORIE IN (10,11,12);

CREATE TABLE BUGETE(
ID_BUGET NUMBER(4) PRIMARY KEY,
ID_CATEGORIE NUMBER(5) NOT NULL,
ID_CONT NUMBER(5) NOT NULL,
SUMA_BUGETATA NUMBER(5),
PERIOADA VARCHAR2(20),
CONSTRAINT FK_BUGETE_CONT FOREIGN KEY(ID_CONT) REFERENCES CONTURI,
CONSTRAINT FK_BUGETE_CATEG FOREIGN KEY(ID_CATEGORIE) REFERENCES CATEGORII
);
ALTER TABLE BUGETE ADD CONSTRAINT CH_SUMA_BUG CHECK(SUMA_BUGETATA>=0);
ALTER TABLE BUGETE ADD CONSTRAINT UNIQ_CONT_CATEG_PER UNIQUE(ID_CONT, ID_CATEGORIE, PERIOADA);
--utilizator 1
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(1,1,100,150,'4 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(2,2,100,100,'O luna');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(3,10,100,700,'O luna');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(4,5,101,400,'3 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(5,7,101,2000,'3 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(6,8,101,3000,'6 luni');
--utilizator 2
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(7,1,102,500,'6 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(8,5,102,700,'3 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(9,10,102,1750,'3 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(10,6,103,500,'3 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(11,8,103,5000,'6 luni');
--utililzator 3
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(12,7,104, 5000, '1 an');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(13,8,104, 4000, '6 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(14,10,104, 200, 'O luna');
--utilizator 4
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(15,2, 105, 400, 'O luna');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(16,5, 105, 500, '3 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(17,6, 105, 150, 'O luna');
--nu isi seteaza buget si pt categoria 7
--utilizator 5
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(18,5,106,1500,'3 luni');-- valoarea bugetului intrece valoarea tranzactiilor
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(19,3,107,800,'2 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(20,8,107,2750,'1 an');
--utilizator 6 
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(21,6,108,1000,'3 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(22,7,108,3000,'3 luni');
--utilizator 7 nu isi seteaza buget
--utilizator 8 nu isi seteaza buget
--utilizator 9 nu isi seteaza buget
--utilizator 10
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(23,1,113,600,'5 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(24,5,113,1000,'2 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(25,6,113,300,'3 luni');
--utilizator 11
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(26,3,114,1000,'3 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(27,6,114,800,'8 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(28,7,114,1000,'O luna');
--utilizator 13
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(29,3,115,1500,'4 luni');
INSERT INTO BUGETE (ID_BUGET, ID_CATEGORIE, ID_CONT, SUMA_BUGETATA, PERIOADA) VALUES
(30,4,115,2750,'1 an');
desc bugete;


--EXERCITII

--SA SE AFISEZE UTILIZATORUL CU NUMELE 'BUZATU' SI PRENUMELE 'ALEXANDRU'
SELECT * FROM UTILIZATORI WHERE INITCAP(NUME)='Buzatu' AND INITCAP(PRENUME)='Alexandru';
--PRINTSCREEN 1

-->, <, >=, <=, !=, IS NULL, LIKE, IN, BETWEEN; 
--1.SA SE AFISEZE TRANZACTIILE A CAROR SUMA INTRECE 1000 LEI;
SELECT * FROM TRANZACTII WHERE SUMA>1000;

--2.SA SE AFISEZE CONTURILE CU UN SOLD MAI MIC DECAT 5000 LEI;
SELECT * FROM CONTURI WHERE SOLD<5000;

--3.SA SE AFISEZE DATORIILE CU VALORI INTRE 3000 SI 6000 LEI;
SELECT * FROM DATORII WHERE SUMA_DATORATA BETWEEN 3000 AND 6000;
SELECT * FROM DATORII WHERE SUMA_DATORATA >=3000 AND SUMA_DATORATA<=6000;

--4.SA SE AFISEZE BUGETELE CARE NU AU O VALOARE DE 1000 LEI
SELECT * FROM BUGETE WHERE SUMA_BUGETATA!=1000;

--5.SA SE AFISEZE DATORIILE FARA DOBANDA
SELECT * FROM DATORII WHERE DOBANDA IS NULL;

--6.SA SE AFISEZE UTILZATORII AL CAROR NUME NU CONTINE LITERA 'U'
SELECT NUME, PRENUME FROM UTILIZATORI WHERE NUME NOT LIKE'%u%';

--7.SA SE AFISEZE UTILIZATORII FARA DATORII 
SELECT ID_UTILIZATOR,NUME,PRENUME FROM UTILIZATORI
WHERE ID_UTILIZATOR NOT IN(SELECT ID_UTILIZATOR FROM DATORII);


--Jonctiuni (inner, outer); 

--8.SA SE AFISEZE NUMELE UTILIZATORILOR CARE AU CONT,PRECUM SI DATELE CONTURILOR FOLOSIND JOIN
SELECT U.ID_UTILIZATOR, U.NUME, U.PRENUME, C.ID_CONT, C.TIP_CONT, C.SOLD
FROM UTILIZATORI U
JOIN CONTURI C ON U.ID_UTILIZATOR = C.ID_UTILIZATOR;

--9.SA SE AFISEZE UTILIZATORII CARE AU SAU AU AVUT DATORII PESTE 5000 LEI, DAR SI CEI 
--FARA DATORII
SELECT U.ID_UTILIZATOR, U.NUME, NVL(D.SUMA_DATORATA, 0) SUMA_DATORATA, NVL(D.STATUS,'NU EXISTA') STATUS
FROM UTILIZATORI U
LEFT JOIN DATORII D ON U.ID_UTILIZATOR = D.ID_UTILIZATOR where D.SUMA_DATORATA > 5000
OR SUMA_DATORATA IS NULL;

--10.SA SE AFISEZE UTILIZATORII FARA DATORII FOLOSIND JOIN
SELECT U.ID_UTILIZATOR, U.NUME, U.PRENUME
FROM UTILIZATORI U
LEFT JOIN DATORII D ON U.ID_UTILIZATOR = D.ID_UTILIZATOR
GROUP BY U.ID_UTILIZATOR, U.NUME, U.PRENUME
HAVING COUNT(D.ID_UTILIZATOR) = 0;

--11.SA SE AFISEZE CATE CONTURI ARE FIECARE UTILIZATOR FOLOSIND JOIN
SELECT U.ID_UTILIZATOR, U.NUME, U.PRENUME, COUNT(C.ID_CONT) NUMAR_CONTURI
FROM UTILIZATORI U JOIN CONTURI C ON U.ID_UTILIZATOR=C.ID_UTILIZATOR
GROUP BY U.ID_UTILIZATOR, U.NUME, U.PRENUME
ORDER BY U.ID_UTILIZATOR;

--12.SA SE AFISEZE CATEGORIILE PRINCIPALE PENTRU CARE NU AU FOST SETATE BUGETE
SELECT C.ID_CATEGORIE, C.DENUMIRE_CATEG
FROM CATEGORII C
LEFT JOIN BUGETE B ON C.ID_CATEGORIE = B.ID_CATEGORIE
WHERE C.ID_CATEG_PARINTE IS NULL AND B.ID_BUGET IS NULL;


--Utilizarea functiilor de grup, GROUP BY, HAVING; 

--13.SA SE AFISEZE SUMA TOTALA A DATORIILOR PENTRU FIECARE UTILIZATOR CARE ARE DATORII
SELECT U.ID_UTILIZATOR, U.NUME, SUM(D.SUMA_DATORATA) TOTAL_DATORII
FROM UTILIZATORI U JOIN DATORII D 
ON U.ID_UTILIZATOR = D.ID_UTILIZATOR
GROUP BY U.ID_UTILIZATOR, U.NUME
HAVING SUM(D.SUMA_DATORATA) > 0
ORDER BY U.ID_UTILIZATOR;

--14.SA SE AFISEZE CATE CONTURI ARE FIECARE UTILIZATOR
SELECT ID_UTILIZATOR, COUNT(*) FROM CONTURI
GROUP BY ID_UTILIZATOR;

--15.SA SE AFISEZE SOLDUL TOTAL AL CONTURILOR PENTRU FIECARE UTILIZATOR UNDE SUMA 
--ESTE MAI MICA DECAT 10000 LEI;
SELECT ID_UTILIZATOR, SUM(SOLD) TOTAL_SOLD 
FROM CONTURI  GROUP BY ID_UTILIZATOR 
HAVING SUM(SOLD) < 10000;

--16.SA SE AFISEZE SUMA TOTALA A VENITURILOR SI CHELTUIELILOR PT FIECARE CONT IN 2023
SELECT C.ID_CONT, T.TIP_TRANZACTIE, SUM(T.SUMA) TOTAL
FROM CONTURI C JOIN TRANZACTII T ON C.ID_CONT = T.ID_CONT
WHERE EXTRACT(YEAR FROM T.DATA_TRANZACTIE) = 2023
GROUP BY C.ID_CONT, T.TIP_TRANZACTIE;

--17.SA SE AFISEZE CATEGORIILE PRINCIPALE IN ORDINE DESCRESCATOARE
--IN FUNCTIE DE BUGETUL TOTAL ALOCAT
SELECT C.ID_CATEGORIE, C.DENUMIRE_CATEG, SUM(B.SUMA_BUGETATA) TOTAL_BUGET
FROM CATEGORII C
JOIN BUGETE B ON C.ID_CATEGORIE = B.ID_CATEGORIE
WHERE C.ID_CATEG_PARINTE IS NULL
GROUP BY C.ID_CATEGORIE, C.DENUMIRE_CATEG
ORDER BY TOTAL_BUGET DESC;

--18.SA SE AFISEZE SOLDUL MEDIU PENTRU CONTURILE DE ECONOMII
SELECT AVG(SOLD) SOLD_MEDIU
FROM CONTURI WHERE TIP_CONT = 'Economii';


--Utilizarea functiilor la nivel de rând (obligatoriu: TO_CHAR*, TO_DATE*, 
--EXTRACT*, SUBSTR*, SYSDATE*, DECODE, CASE*, NVL*); 

--19.SA SE AFISEZE TRANZACTIILE TIP 'CHELTUIALA' CU SUMA 750,800 SI 1000 LEI 
--REALIZATE DUPA 6 IUNIE
SELECT * FROM TRANZACTII WHERE SUMA IN (750,800,1000) 
AND TIP_TRANZACTIE = 'Cheltuiala' AND DATA_TRANZACTIE > TO_DATE('2023-06-06', 'YYYY-MM-DD');

--20.SA SE AFISEZE TRANZACTIILE DE TIP VENIT REALIZATE IN LUNA DECEMBRIE
SELECT * FROM TRANZACTII WHERE TIP_TRANZACTIE LIKE 'V%'
AND EXTRACT(MONTH FROM DATA_TRANZACTIE)=12;

--21.SA SE AFISEZE UTILIZATORII CU VARSTA MAI MARE DECAT 30 ANI
SELECT ID_UTILIZATOR, NUME, PRENUME, TRUNC(MONTHS_BETWEEN(SYSDATE, DATA_NASTERII)/12) VARSTA
FROM UTILIZATORI 
WHERE MONTHS_BETWEEN(SYSDATE, DATA_NASTERII)/12>30;

--22.SA SE AFISEZE CONTURILE AL CAROR TOTAL AL CHELTUIELILOR ESTE MAI MARE SAU EGAL 
--DECAT 5000 LEI 
SELECT C.ID_CONT, SUM(T.SUMA) TOTAL_CHELTUIELI
FROM CONTURI C JOIN TRANZACTII T ON C.ID_CONT = T.ID_CONT
WHERE T.TIP_TRANZACTIE = 'Cheltuiala' 
AND EXTRACT(YEAR FROM T.DATA_TRANZACTIE) = 2023
GROUP BY C.ID_CONT HAVING SUM(T.SUMA) >= 5000;

--23. SA SE CLASIFICE CONTURILE CA 'SOLD MARE' SAU 'SOLD NORMAL' IN FUNCTE DE SOLD
SELECT ID_CONT, SOLD,
       CASE
           WHEN SOLD > 10000 THEN 'Sold Mare'
           ELSE 'Sold Normal'
       END TIP_SOLD
FROM CONTURI
ORDER BY ID_CONT;

--24.SA SE AFISEZE PRIMELE 5 CARACTERE ALE ADRESEI DE EMAIL A FIECARUI UTILIZATOR
SELECT ID_UTILIZATOR, EMAIL, SUBSTR(EMAIL, 1, 5) PARTE_EMAIL
FROM UTILIZATORI;

--25.SA SE CLASIFICE STAREA DATORIILOR FOLOSIND DECODE
SELECT ID_DATORIE, CREDITOR, SUMA_DATORATA,
DECODE(STATUS,'Activa','Deschisa', 'Inchisa', 'Inchisa', 'Necunoscut') STARE_DATORIE
FROM DATORII;

--26.SA SE AFISEZE SOLDUL ACTUAL AL CONTURILOR
SELECT C.ID_CONT, C.SOLD SOLD_INITIAL,
SUM( CASE WHEN T.TIP_TRANZACTIE='Venit' THEN T.SUMA ELSE 0 END) TOTAL_VENITURI,
SUM(CASE WHEN T.TIP_TRANZACTIE='Cheltuiala' THEN T.SUMA ELSE 0 END) TOTAL_CHELTUIELI,
(C.SOLD+SUM(CASE WHEN T.TIP_TRANZACTIE='Venit' THEN T.SUMA ELSE 0 END)- SUM(CASE WHEN T.TIP_TRANZACTIE='Cheltuiala' THEN T.SUMA ELSE 0 END)) SOLD_FINAL
FROM CONTURI C LEFT JOIN TRANZACTII T ON C.ID_CONT=T.ID_CONT
GROUP BY C.ID_CONT, C.SOLD;

--27.SA SE AFISEZE ZIUA SAPTAMANII PENTRU DATA FIECAREI TRANZACTII FACUTE DUPA LUNA IULIE
SELECT DATA_TRANZACTIE, TO_CHAR(DATA_TRANZACTIE,'Day') ZIUA_SAPTAMANII
FROM TRANZACTII
WHERE EXTRACT(MONTH FROM DATA_TRANZACTIE)>7;

--Utilizarea operatorilor UNION, MINUS, INTERSECT; 
--28.SA SE AFISEZE NUMELE UTILIZATORILOR SI AL CREDITORILOR
SELECT  NUME, PRENUME FROM UTILIZATORI
UNION
SELECT CREDITOR, NULL FROM DATORII;

--29.SA SE AFISEZE UTILIZATORII FARA DATORII FOLOSIND MINUS
SELECT ID_UTILIZATOR FROM UTILIZATORI
MINUS
SELECT ID_UTILIZATOR FROM DATORII;

--30.SA SE AFISEZE UTILIZATORII CARE AU SI CONTURI SI DATORII FOLOSIND INTERSECT
SELECT ID_UTILIZATOR, NUME FROM UTILIZATORI U
WHERE U.ID_UTILIZATOR IN (
SELECT C.ID_UTILIZATOR FROM CONTURI C
INTERSECT
SELECT D.ID_UTILIZATOR FROM DATORII D)
ORDER BY ID_UTILIZATOR;


--Subcereri simple si corelate; 

--SIMPLA
--31.SA SE AFISEZE CONTURILE CU SOLD PESTE MEDIE
SELECT  ID_CONT, SOLD FROM CONTURI
WHERE SOLD>(SELECT AVG(SOLD) FROM CONTURI);

--CORELATA
--32.SA SE AFISEZE TRANZACTIA/TRANZACTIILE CU CEA MAI MARE SUMA PENTRU FIECARE CONT
SELECT C.ID_CONT, T.ID_TRANZACTIE, T.SUMA, T.TIP_TRANZACTIE
FROM CONTURI C
JOIN TRANZACTII T ON C.ID_CONT = T.ID_CONT
WHERE T.SUMA = (
    SELECT MAX(T2.SUMA)
    FROM TRANZACTII T2
    WHERE T2.ID_CONT = C.ID_CONT
);
 
 
--Cereri ierarhice
--33.SA SE AFISEZE STRUCTURA IERARHICA A CATEGORIILOR FOLOSIND SYS_CONNECT_BY_PATH
SELECT ID_CATEGORIE, DENUMIRE_CATEG, LEVEL, SYS_CONNECT_BY_PATH(DENUMIRE_CATEG, '/') PATH
FROM CATEGORII
START WITH ID_CATEG_PARINTE IS NULL
CONNECT BY PRIOR ID_CATEGORIE = ID_CATEG_PARINTE;

--34.SA SE AFISEZE STRUCTURA IERARHICA A CATEGORIILOR
SELECT LPAD(' ', LEVEL * 2, ' ') || DENUMIRE_CATEG CATEGORIE_IERARHICA, LEVEL
FROM CATEGORII
START WITH ID_CATEG_PARINTE IS NULL
CONNECT BY PRIOR ID_CATEGORIE = ID_CATEG_PARINTE
ORDER SIBLINGS BY DENUMIRE_CATEG;


--CASE
--35.SA SE DESCRIE FIECARE TRANZACTIE PE BAZA SUMEI('MICA','MEDIE','MARE')
SELECT ID_TRANZACTIE, SUMA,
CASE
    WHEN SUMA<= 100 THEN 'TRANZACTIE MICA'
    WHEN SUMA>100 AND SUMA<=1000 THEN 'TRANZACTIE MEDIE'
    WHEN SUMA>1000 AND SUMA<=5000 THEN 'TRANZACTIE MARE'
    ELSE 'TRANZACTIE FOARTE MARE'
    END DESCRIERE
FROM TRANZACTII;



--Construirea si utilizarea altor 
--obiecte ale bazei de date: tabele virtuale, indec?i, sinonime ?i secven?e. 

--36.SA SE CREEZE UN VIEW CARE AFISEAZA SOLDUL TOTAL PENTRU FIECARE UTILIZATOR
CREATE VIEW VIZUALIZARE_SOLD_UTILIZATOR AS
SELECT U.ID_UTILIZATOR, U.NUME, SUM(C.SOLD) TOTAL_SOLD
FROM UTILIZATORI  U JOIN CONTURI C 
ON U.ID_UTILIZATOR=C.ID_UTILIZATOR
GROUP BY U.ID_UTILIZATOR, U.NUME;

SELECT * FROM VIZUALIZARE_SOLD_UTILIZATOR;

--37.CREATI UN INDEX PE COLOANA 'DATA_TRANZACTIE' DIN TABELUL TRANZACTII
CREATE INDEX IDX_DATA_TRANZACTIE ON TRANZACTII(DATA_TRANZACTIE);
SELECT * FROM USER_INDEXES;

--38.SA SE CREEZE UN SINONIM PENTRU TABELA DATORII
CREATE SYNONYM DAT FOR DATORII;
SELECT * FROM USER_SYNONYMS;

--39.SA SE STEARGA CATEGORIA CU ID-UL 205
DELETE FROM CATEGORII WHERE ID_CATEGORIE=205;

--40.SA SE SCHIMBE ID-UL CONTULUI IN 112 PENTRU TRANZACTIA CU ID-UL 47
UPDATE TRANZACTII SET ID_CONT=112 WHERE ID_TRANZACTIE=47;

--41.SA SE SCHIMBE SUMA BUGETATA IN 600 PENTRU BUGETUL CU ID-UL 10
UPDATE BUGETE SET SUMA_BUGETATA=600 WHERE ID_BUGET=10;

COMMIT;


